---
title: 2018-3-19 会话管理
tags: 会话管理,Servlet
grammar_cjkRuby: true
---

HTTP具有无状态性,使得**会话管理**和**会话跟踪**变得困难.
一个WEB服务器无法区分一个HTTP请求是否为第一次访问.
例如,一个邮件要在用户登录后记住已经登录.也即是说,应用必须能管理用户的会话.

将阐述:URL重写,隐藏域,cookies,HTTPSession对象

## 2.1 URL重写
URL重写是一种会话跟踪技术，它将一个或多个token添加到URL的查询字符串中，每个token通常为key=value形式，如下:
`url?key-1=value-1&key-2=value-2 ... &key-n=value-n`
注意，URL和tokens间用问号（？）分割，token间用与号（&）。

* URL在某些浏览器上最大长度为2000字符；
* 若要传递值到下一个资源，需要将值插入到链接中，换句话说，静态页面很难传值；
* URL重写需要在服务端上完成，所有的链接都必须带值，因此当一个页面存在很多链接时，处理过程会是一个不小的挑战；
* 某些字符，例如空格、与和问号等必须用base64编码；
* 所有的信息都是可见的，某些情况下不合适。

因为存在如上限制，URL重写仅适合于信息仅在少量页面间传递，且信息本身不敏感。

## 2.2 隐藏域
放到HTML表单的隐藏域中,但是只在网页有表单时有效.相对于URL重写的优势在于,无字数限制.但也不适合跨越多个界面.
`writer.println("<input type='hidden' name='id' value='"
                    + customerId + "'/>");`
## 2.3 Cookies\
Cookie作为HTTP header的一部分由HTTP协议控制,每个网站20个cookie
要使用cookies需要类
javax.servlet.http.Cookie
以及HttpServletResponse HttpServletRequest的两个接口
```java
//通过传递name,value给cookie构造函数创建cookie
Cookie cookie = new Cookie(name,value);
//如创建语言选择
Cookie languageSelectionCoolie = new Cookie("language","Italian');
//然后可以设置domain,path,maxAge(决定cookie何时过期)属性

//要将cookie发送到浏览器
response.addCookie(cookie);

//Cookie也可以通过javascript脚本创建和删除(书里没讲
//服务端提交cookie,通过request.getCookies返回一个Cookie数组,
//否则返回null.你需要遍历整个数组查询特定名称的cookie

Cookie[] cookies = request.getCookies();
Cookie maxRecoredsCookie = null;
if(cookies != null){
	for(Cookie cookie : cookies){
		if(cookie.getName().equals("maxRecored")){
			maxRecoredCookie = cookie;
		}
	}
}

```
